<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <title>Dashboard-Simplydrop</title>
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <!-- Custom fonts for this template -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="static/css/sb-admin-2.min.css" rel="stylesheet">
    <!-- Bootstrap core css -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Bootstrap core JavaScript-->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o" crossorigin="anonymous"></script>
    <!-- Librerias de tabla DataTables-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/jq-3.3.1/jszip-2.5.0/dt-1.10.18/af-2.3.3/b-1.5.6/b-colvis-1.5.6/b-flash-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/fc-3.2.5/fh-3.1.4/kt-2.5.0/r-2.2.2/rg-1.1.0/rr-1.2.4/sc-2.0.0/sl-1.3.0/datatables.min.css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/jq-3.3.1/jszip-2.5.0/dt-1.10.18/af-2.3.3/b-1.5.6/b-colvis-1.5.6/b-flash-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/fc-3.2.5/fh-3.1.4/kt-2.5.0/r-2.2.2/rg-1.1.0/rr-1.2.4/sc-2.0.0/sl-1.3.0/datatables.min.js"></script>
    <!-- Favicon -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- CDN de banderas -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.3.0/css/flag-icon.css" />

</head>

<body id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Main Content -->
            <div id="content">
                <!-- Topbar -->
                <nav class="navbar navbar-expand-lg navbar-dark bg-primary ">
                    <a class="navbar-brand" href="/index">
                        <img src="static/img/favicon-32x32.png" width="30" height="30" class="d-inline-block align-top" alt=""> SimplyDrop
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <!-- Topbar Navbar -->
                    <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item active">
                                <a class="nav-link" href="/index">
                                    <i class="fas fa-fw fa-table"></i>
                                    <span>Orders</span></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/notify-manager">
                                    <i class="fas fa-fw fa-chart-area"></i>
                                    <span>Notifications Options</span></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/carrier-manager">
                                    <i class="fas fa-fw fa-chart-area"></i>
                                    <span>Carriers Info</span></a>
                            </li>
                        </ul>
                        <a class="navbar-brand" href="/shop">
                            <img src="static/img/shopify-bag.png" width="30" height="30" class="d-inline-block align-top" alt="">
                        </a>
                    </div>
                </nav>
                <!-- End of Topbar -->
                <!-- Begin Page Content -->
                <div class="container-fluid pt-5">
                    <!-- Page Heading -->
                    <h1 class="h3 mb-2 text-gray-800">Current orders</h1>
                    <p class="mb-4">In this screen you can find all the orders of your store in progress.</p>

                    <!-- Content Row -->
                    <div class="row">
                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Earnings (Monthly)
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{earning_this_month}} {{currency}}</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-calendar fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Earnings (Annual)
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{earning_this_year}} {{currency}} </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Sales compared to last month</div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">{{compare_month_percent}}%</div>
                                                </div>
                                                <div class="col">
                                                    <div class="progress progress-sm mr-2">
                                                        <div class="progress-bar bg-info" role="progressbar" style="width: {{compare_month_percent}}%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Pending Requests Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Orders this month
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{orders_this_month}}</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-truck fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
                    </div>
                    <!-- DataTales Example -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Orders</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" style="width:100%" id="orders_table">
                                    <thead>
                                        <tr>
                                            <th>Id</th>
                                            <th>Amount</th>
                                            <th>Country</th>
                                            <th>Customer Email</th>
                                            <th>Carrier</th>
                                            <th>Type of Shipping</th>
                                            <th>State</th>
                                            <th class="desktop"></th>
                                            <th class="desktop"></th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr>
                                            <th>Id</th>
                                            <th>Amount</th>
                                            <th>Country</th>
                                            <th>Customer Email</th>
                                            <th>Carrier</th>
                                            <th>Type of Shipping</th>
                                            <th>State</th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.container-fluid -->
            </div>
            <!-- End of Main Content -->
            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; SimplyDrop 2019</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->
        </div>
        <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->

    <!--Script para cargar la tabla -->
    <script>
        $(document).ready(function() {

            var table = $('#orders_table').DataTable({
              "order": [
                    [0, "desc"]
                ],
                "language": {
                    "emptyTable": "No orders for traking"
                },
                "ajax": {
                    "url": "tableDataOrders",
                    "dataSrc": function(json) {
                        return json.data;
                    }

                },
                columns: [{
                        "data": "Id"
                    }, {

                        "data": function getAmountAndCurrency(data, type, dataToSet) {
                            var currency = ""
                            if (data.Currency === "EUR") {
                                currency = "€";
                            }
                            if (data.Currency === "USD") {
                                currency = "$";
                            }

                            return data.Amount + " " + currency;
                        }
                    },

                    {
                        "orderable": false,

                        // "defaultContent": '<a href="javascript:void(0);" class="label d-none d-sm-inline-block btn  btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm  text-white-50"></i>Label</a>',

                        "data": function(data, type, full, meta) {
                            flag = "";
                            if (type === 'display') {

                                flagCountry = "flag-icon-" + data.Customer_country_code;
                                countryName = data.Country

                                flag = '<div data-toggle="tooltip" title="3": center;"><span class="flag-icon ' + flagCountry + '"></span> ' + countryName + '</div>';

                            }
                            return flag;
                        }

                    },

                    {
                        "data": "Email"
                    }, {
                        "data": "Carrier"
                    }, {
                        "data": "Type"
                    }, {
                        "data": "State"
                    }, {
                        "data": null,
                        "defaultContent": '  <a href="javascript:void(0);" class="items btn btn-light btn-icon-split btn-sm"">\n' +
                            '                    <span class="icon text-gray-600">\n' +
                            '                      <i class="fas fa-arrow-down"></i>\n' +
                            '                    </span>\n' +
                            '                    <span class="text">Items</span>\n' +
                            '                  </a>',
                        "orderable": false

                    },

                    {
                        "data": "Carrier",
                        "orderable": false,

                        // "defaultContent": '<a href="javascript:void(0);" class="label d-none d-sm-inline-block btn  btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm  text-white-50"></i>Label</a>',

                        "render": function(data, type, full, meta) {
                            if (type === 'display') {
                                console.log(data)
                                if (data === "No carrier") {
                                    label = " No label";
                                } else {
                                    label = '<a href="javascript:void(0);" class="label d-none d-sm-inline-block btn  btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm  text-white-50"></i>Label</a>';
                                }
                            }
                            return label;

                        }

                    }

                ]
            });

            $('#orders_table tbody').on('click', 'a.label', function() {
                var data = table.row($(this).parents('tr')).data();
                alert(data[0] + "'s salary is: " + data[5]);
            });

            $('#orders_table tbody').on('click', 'a.items', function() {

                var row = table.row($(this).parents('tr'))

                if (row.child.isShown()) {
                    // This row is already open - close it
                    row.child.hide();
                } else {
                    // Open this row
                    row.child(format(row.data())).show();
                }
            });

            function format(d) {

                console.log(d);
                tab = '';
                currency = "";

                if (d.Currency == "EUR") {
                    currency = "€";
                }
                if (d.Currency == "USD") {
                    currency = "$";
                }

                for (i = 0; i < d.Items.length; i++) {
                    weight = d.Items[i].weigth;
                    weight = weight / 1000;
                    bod = '            <tr>\n' +
                        '                <td style="vertical-align: middle;"><img src="' + d.Items[i].image + '" alt="" style="width:60px; height:auto; border-radius: 15%;"></td>\n' +
                        '                <td style=" vertical-align: middle;">' + d.Items[i].price + ' ' + currency + '</td>\n' +
                        '                <td style="vertical-align: middle;">' + d.Items[i].quantity + '</td>\n' +
                        '                <td style="vertical-align: middle;">' + d.Items[i].sku + '</td>\n' +
                        '                <td style="vertical-align: middle;">' + d.Items[i].title + '</td>\n' +
                        '                <td style="vertical-align: middle;"> ' + weight + ' (Kg)</td>\n' +
                        '            </tr>';

                    tab = tab + bod;

                }

                // `d` is the original data object for the row

                return '<table id="items_table" class="table table-sm table-active" style="width:100%">\n' +
                    '        <thead>\n' +
                    '            <tr>\n' +
                    '                <th >Image</th>\n' +
                    '                <th>Price</th>\n' +
                    '                <th>Quantity</th>\n' +
                    '                <th>Sku</th>\n' +
                    '                <th>Title</th>\n' +
                    '                <th>Weigth</th>\n' +
                    '            </tr>\n' +
                    '        </thead>\n' +
                    '        <tbody>\n' +
                    '                ' + this.tab + '\n' +
                    '            </tr>\n' +
                    '        </tbody>\n' +
                    '\n' +
                    ' </table>\n';

            }
        });
    </script>
</body>

</html>