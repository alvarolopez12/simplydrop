<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <title>Dashboard-Simplydrop</title>
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <!-- Custom fonts for this template -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="static/css/sb-admin-2.min.css" rel="stylesheet">
    <!-- Bootstrap core css -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Bootstrap core JavaScript-->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o" crossorigin="anonymous"></script>
    <!-- Librerias de tabla DataTables-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/jq-3.3.1/jszip-2.5.0/dt-1.10.18/af-2.3.3/b-1.5.6/b-colvis-1.5.6/b-flash-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/fc-3.2.5/fh-3.1.4/kt-2.5.0/r-2.2.2/rg-1.1.0/rr-1.2.4/sc-2.0.0/sl-1.3.0/datatables.min.css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/jq-3.3.1/jszip-2.5.0/dt-1.10.18/af-2.3.3/b-1.5.6/b-colvis-1.5.6/b-flash-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/fc-3.2.5/fh-3.1.4/kt-2.5.0/r-2.2.2/rg-1.1.0/rr-1.2.4/sc-2.0.0/sl-1.3.0/datatables.min.js"></script>
    <!-- Favicon -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>

<body id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Main Content -->
            <div id="content">
                <!-- Topbar -->
                <nav class="navbar navbar-expand-lg navbar-dark bg-primary ">
                    <a class="navbar-brand" href="/index">
                        <img src="static/img/favicon-32x32.png" width="30" height="30" class="d-inline-block align-top" alt=""> SimplyDrop
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <!-- Topbar Navbar -->
                    <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item ">
                                <a class="nav-link" href="/index">
                                    <i class="fas fa-fw fa-table"></i>
                                    <span>Orders</span></a>
                            </li>
                            <li class="nav-item active">
                                <a class="nav-link" href="/notify-manager">
                                    <i class="fas fa-fw fa-chart-area"></i>
                                    <span>Notifications Options</span></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/carrier-manager">
                                    <i class="fas fa-fw fa-chart-area"></i>
                                    <span>Carriers Info</span></a>
                            </li>
                        </ul>
                        <a class="navbar-brand" href="/shop">
                            <img src="static/img/shopify-bag.png" width="30" height="30" class="d-inline-block align-top" alt="">
                        </a>
                    </div>
                </nav>
                <!-- End of Topbar -->
                <!-- Begin Page Content -->
                <div class="container-fluid pt-5">
                    <!-- Page Heading -->
                    <h1 class="h3 mb-2 text-gray-800">Notification setup</h1>
                    <p class="mb-4">In this screen you can find and setup all the fullfilment notifications</p>
                    <p class="mb-4">If you want to receive updates using the telegram bot, add it from: <a href="/bot">SimplyDropBot</a></p>

                    <!-- Content Row -->
                    <!-- DataTales Example -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" style="width:100%" id="users_table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Last Name</th>
                                            <th>Email</th>
                                            <th>Telegram Bot Code</th>
                                            <th>Notification Frencuency</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr>
                                            <th>Name</th>
                                            <th>Last Name</th>
                                            <th>Email</th>
                                            <th>Telegram Bot Bode</th>
                                            <th>Notification Frencuency</th>
                                            <th></th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container-fluid">
                    <!-- Page Heading -->
                    <h1 class="h3 mb-2 text-gray-800">Add new email user</h1>
                    <!-- Content Row -->
                    <!-- DataTales Example -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                        </div>
                        <div class="card-body">
                            <form name="UserForm" action="/user-form" method="post" onsubmit="return checkUserForm()">
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="inputEmail4">Name</label>
                                        <input name="Name" type="name" class="form-control" id="inputName" placeholder="Name">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="inputPassword4">Last Name</label>
                                        <input name="LastName" type="lastname" class="form-control" id="inputLastName" placeholder="Last Name">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="inputEmail">Email</label>
                                    <input name="Email" type="text" class="form-control" id="inputEmail" placeholder="Notification Email">
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label for="inputState">Notification Frequency</label>
                                        <select name="NotifyType" id="inputState" class="form-control">
                                            <option selected>Choose...</option>
                                            <option>After each order</option>
                                            <option>Daily summary</option>
                                            <option>Weekly summary</option>
                                            <option>Monthly summary</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Sign in</button>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- /.container-fluid -->
            </div>
            <!-- End of Main Content -->
            <!-- Modal -->
            <div id="myModal" class="modal fade" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title"></h4>
                        </div>
                        <div class="modal-body">
                            <p></p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; SimplyDrop 2019</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->
        </div>
        <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>
    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>
    <!--Script para cargar la tabla -->
    <script>
        $(document).ready(function() {
            var table = $('#users_table').DataTable({
                "language": {
                    "emptyTable": "No notification users register"
                },
                "ajax": {
                    "url": "tableDataNotify",
                    "dataSrc": function(json) {
                        return json.data;
                    }

                },
                columns: [{
                        "data": "Name"
                    }, {
                        "data": "LastName"
                    }, {
                        "data": "Email"
                    }, {
                        "data": "TelegramBotCode"
                    },

                    {
                        "data": "NotifyFreq",
                        "orderable": false,
                        "render": function(data, type, full, meta) {
                            if (type === 'display') {
                                if (data === "After each order") {
                                    NewNotifyFrec = '<select name="NotifyFreqTable" id="inputState" class="NotifyFreqTable form-control">\n' +
                                        '    <option selected>' + data + '</option>\n' +
                                        '    <option>Daily summary</option>\n' +
                                        '    <option>Weekly summary</option>\n' +
                                        '    <option>Monthly summary</option>\n' +
                                        '  </select>';
                                }
                                if (data === "Daily summary") {
                                    NewNotifyFrec = '<select name="NotifyFreqTable" id="inputState" class="NotifyFreqTable form-control">\n' +
                                        '    <option selected>' + data + '</option>\n' +
                                        '    <option>After each order</option>\n' +
                                        '    <option>Weekly summary</option>\n' +
                                        '    <option>Monthly summary</option>\n' +
                                        '  </select>';
                                }
                                if (data === "Weekly summary") {
                                    NewNotifyFrec = '<select name="NotifyFreqTable" id="inputState" class="NotifyFreqTable form-control">\n' +
                                        '    <option selected>' + data + '</option>\n' +
                                        '    <option>After each order</option>\n' +
                                        '    <option>Daily summary</option>\n' +
                                        '    <option>Monthly summary</option>\n' +
                                        '  </select>';
                                }
                                if (data === "Monthly summary") {
                                    NewNotifyFrec = '<select name="NotifyFreqTable" id="inputState" class="NotifyFreqTable form-control">\n' +
                                        '    <option selected>' + data + '</option>\n' +
                                        '    <option>After each order</option>\n' +
                                        '    <option>Daily summary</option>\n' +
                                        '    <option>Weekly summary</option>\n' +
                                        '  </select>';
                                }
                            }
                            return NewNotifyFrec;
                        }
                    }, {
                        "data": null,
                        "defaultContent": '                  <a href="#" class="deleteUser btn btn-danger ">\n' +
                            '                    <span class="icon text-white-50">\n' +
                            '                      <i class="fas fa-trash"></i>\n' +
                            '                  </a>',
                        "orderable": false
                    }
                ]
            });

            $('#users_table tbody').on('click', 'a.deleteUser', function() {
                var tr = $(this).closest('tr');
                var row = table.row(tr);

                if (confirm("Are you sure you want to delete the user " + row.data().Name + " ?") == true) {

                    $.ajax({
                        type: "post",
                        url: "user-delete",
                        cache: false,
                        data: {
                            Email: row.data().Email,
                            Name: row.data().Name
                        },
                        async: "asynchronous",
                        success: function(html) {
                            location.reload();
                        }
                    });
                }

            });
            <!--Script para cambiar Frecuencia de notificacion -->
            $('#users_table tbody').on('change', 'select.NotifyFreqTable', function() {
                var optionSelected = $("option:selected", this);
                var valueSelected = this.value;

                var tr = $(this).closest('tr');
                var row = table.row(tr);

                confirm("Are you sure you want to change the user " + row.data().Name + " the frequency of notification to: " + valueSelected + " ?");

                $.ajax({
                    type: "post",
                    url: "user-freq-change",
                    cache: false,
                    data: {
                        Email: row.data().Email,
                        NewFreq: valueSelected
                    },
                    async: "asynchronous",
                });

            });

        });
    </script>
    <!--Script para validar fromulario de usuario -->
    <script>
        function checkUserForm() {
            var name = document.forms["UserForm"]["Name"];
            var lastName = document.forms["UserForm"]["LastName"];
            var email = document.forms["UserForm"]["Email"];
            var what = document.forms["UserForm"]["NotifyType"];

            if (name.value == "") {
                window.alert("Please enter your name.");
                name.focus();
                return false;
            }

            if (lastName.value == "") {
                window.alert("Please enter your last name.");
                name.focus();
                return false;
            }

            if (email.value == "") {
                window.alert("Please enter a valid e-mail address.");
                email.focus();
                return false;
            }

            if (email.value.indexOf("@", 0) < 0) {
                window.alert("Please enter a valid e-mail address.");
                email.focus();
                return false;
            }

            if (email.value.indexOf(".", 0) < 0) {
                window.alert("Please enter a valid e-mail address.");
                email.focus();
                return false;
            }

            if (what.selectedIndex < 1) {
                alert("Please enter your notification frequency.");
                what.focus();
                return false;
            }
            return true;
        }
    </script>
</body>

</html>